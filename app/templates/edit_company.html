{% extends "base.html" %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <h2>Edit Company</h2>
            <div class="card">
                <div class="card-body">
                    <form method="POST">
                        <div class="mb-3">
                            <label for="name" class="form-label">Company Name</label>
                            <input type="text" class="form-control" id="name" name="name" value="{{ company.name }}" required>
                        </div>
                        <div class="mb-3">
                            <label for="sector" class="form-label">Sector</label>
                            <select class="form-control" id="sector" name="sector" required onchange="updateIndustries()">
                                <option value="">Select Sector</option>
                                {% for sector in sectors %}
                                <option value="{{ sector }}" {{ 'selected' if sector == company.sector }}>{{ sector }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="industry" class="form-label">Industry</label>
                            <select class="form-control" id="industry" name="industry" required>
                                <option value="">Select Industry</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="location" class="form-label">Location</label>
                            <input type="text" class="form-control" id="location" name="location" value="{{ company.location }}">
                        </div>
                        <div class="mb-3">
                            <label for="contact_person" class="form-label">Contact Person</label>
                            <input type="text" class="form-control" id="contact_person" name="contact_person" value="{{ company.contact_person }}">
                        </div>
                        <div class="mb-3">
                            <label for="email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="email" name="email" value="{{ company.email }}">
                        </div>
                        <div class="mb-3">
                            <label for="phone" class="form-label">Phone</label>
                            <input type="text" class="form-control" id="phone" name="phone" value="{{ company.phone }}">
                        </div>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                        <a href="{{ url_for('main.companies') }}" class="btn btn-secondary">Cancel</a>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
(function(window, document) {
    "use strict";
    var sectorIndustries = JSON.parse('{{ sectors_json|tojson|safe }}');
    var currentIndustry = "{{ company.industry }}";

    function updateIndustries() {
        var sector = document.getElementById('sector').value;
        var industrySelect = document.getElementById('industry');
        
        industrySelect.innerHTML = '<option value="">Select Industry</option>';
        
        if (sector && sectorIndustries[sector]) {
            sectorIndustries[sector].forEach(function(industry) {
                var option = document.createElement('option');
                option.value = industry;
                option.textContent = industry;
                if (industry === currentIndustry) {
                    option.selected = true;
                }
                industrySelect.appendChild(option);
            });
        }
    }

    window.updateIndustries = updateIndustries;
    document.getElementById('sector').addEventListener('change', updateIndustries);
    // Initialize on load
    updateIndustries();
})(window, document);
</script>
{% endblock %} 